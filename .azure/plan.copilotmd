# Azure Deployment Plan for galaxy-chat-hub Project

## **Goal**
Deploy the galaxy-chat-hub project (React Frontend + Node.js/Express Backend + PostgreSQL) to Azure using the Azure Developer CLI (AZD).

## **Project Information**
- **AppName**: galaxy-chat-hub
- **Stack**: React (Vite) Frontend, Node.js Express Backend
- **Type**: Real-time Chat Application
- **Containerization**: To be added
- **Dependencies**: PostgreSQL
- **Hosting**: Azure Container Apps (ACA)

## **Azure Resources Architecture**
```mermaid
graph TD
%% Services
svc_backend["`Name: backend
Path: backend
Language: js`"]
svc_frontend["`Name: frontend
Path: .
Language: ts`"]
subgraph "Compute Resources"
%% Resources
subgraph containerappenv["Azure Container Apps (ACA) Environment"]
caa_backend("`backend (Azure Container App)`")
caa_frontend("`frontend (Azure Container App)`")
end
containerappenv:::cluster
end
subgraph "Dependency Resources"
%% Dependency Resources
db_postgres["`db (Azure Database for PostgreSQL)`"]
end
%% Relationships
svc_backend --> |"hosted on"| caa_backend
caa_backend -.-> |"secret"| db_postgres
svc_frontend --> |"hosted on"| caa_frontend
caa_frontend -.-> |"http"| caa_backend
```

- The `backend` Container App hosts the Express API and Socket.IO server.
- The `frontend` Container App hosts the Vite-built React static files (served via a lightweight server like Nginx or Serve).
- The `backend` connects to `Azure Database for PostgreSQL`.

## **Expected Azure Resources**

### Service: backend
- **Hosting Service Type**: Azure Container Apps
- **Configuration**:
    - **Language**: Node.js
    - **Environment Variables**: `DATABASE_URL` (connection to Postgres), `PORT` (80/3000)
- **Dependencies**:
    - **Type**: Azure Database for PostgreSQL Flexible Server
    - **Connection**: Connection String (Secret)

### Service: frontend
- **Hosting Service Type**: Azure Container Apps
- **Configuration**:
    - **Language**: TypeScript/React
    - **Environment Variables**: `VITE_API_URL` (Pointer to backend-api)

### Supporting Services
- **Azure Container Registry (ACR)**: To store Docker images.
- **Log Analytics Workspace**: For logs and monitoring.
- **Managed Identity**: For secure access to resources.
- **Key Vault** (Optional): To store database credentials.

## **Execution Steps**

1. **Containerization**
   - Create `Dockerfile` for `backend`.
   - Create `Dockerfile` for `frontend` (Multi-stage build: build React -> serve with Nginx).

2. **Infrastructure Initialization (AZD)**
   - Initialize `azd` project in the root.
   - Generate Bicep modules for Container Apps and Postgres.

3. **Deployment**
   - Run `azd up` to provision resources and deploy code.

4. **Configuration**
   - Update `VITE_API_URL` in frontend to point to the deployed backend URL.
   - Update `DATABASE_URL` in backend to point to the Azure Postgres instance.
